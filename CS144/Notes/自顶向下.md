# 计算机网络：自顶向下方法

## 第1章 计算机网络和因特网

### 1.1 什么是因特网

#### 1.1.1 具体构成描述

主机(host)  or 端系统(end system)

- 端系统通过通信链路（communication link）和分组交换机（packet switch）连接在一起
- 不同链路有不同的传输速率，单位是bps(bit/s)
- 端系统之间发送数据时，数据分段，并为每段加上首部字节 ===> 由此形成信息包成为分组(packet)
- 分组交换机最著名的是路由器（router）和链路层交换机（link-layer switch）
- 从发送端系统到接收端系统， 一个**分组**所经历的一系列通信链路和分组交换机称为通过该网络的路径 (route或path)

端系统通过因特网服务提供商（Internet Service Provider，ISP）接入因特网，每个ISP自身就是一个由多台分组交换机和多段通信链路组成的网络

端系统、分组交换机和其他因特网部件都要运行一系列**协议Protocol**

因特网标准Internet Standard由因特网工程任务组Internet Engineering Task Force，IETF研发，IETF的标准文档称为请求文档Request For Comment，RFC

#### 1.1.2 服务描述

涉及多个相互交换数据的端系统 ===> **分布式应用程序**(distributed application)

与因特网相连的端系统提供了一个**套接字接口** (socket interface) , 该接口规定了运行在一个端系统上的程序请求因特网基础设施向运行在 另一个端系统上的特定目的地程序交付数据的方式 

#### 1.1.3 什么是协议(protocol)

**协议 (protocol)** 定义了在两个或多个通信实体之间交换的报文的格式和顺 序，以及报文发送和/或接收一条报文或其他事件所采取的动作 

<img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2012.59.04.png" alt="截屏2022-10-08 12.59.04" style="zoom:50%;" />

### 1.2 网络边缘

端系统容纳应用程序

- 客户端client
- 服务器server

#### 1.2.1 接入网

指将 端系统物理连接到其边缘路由器 (edge router) 的网络 

1. 家庭接入：DSL、电缆、FTTH、拨号和卫星

   DSL(Digital Subscriber Line):每个用户的DSL 调制解调器使用现有的电话线<img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2013.09.33.png" alt="截屏2022-10-08 13.09.33" style="zoom:50%;" />

   电缆因特网接入 (cable Internet access ) 利用了有线电视公司现有的有线电视基础设施

   <img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2013.19.05.png" alt="截屏2022-10-08 13.19.05" style="zoom:50%;" />

   - 共享广播媒体
   - 如果儿个用户同时经下行信道下载一个视频文件，每个用户接收视频文件的实际速率将大大 低于电缆总计的下行速率 

   光纤到户 (Fiber To The Home , FTTH)，从本地中心局直接到家庭提供了一条光纤路径。更为一般的是，从中心局出来的每根光纤实际上由许多家庭共享，直到相对接近这些家庭的位置再分成每户一根光纤，进行这种分配有两种有竞争性的光纤分布体系结构 : 

   - 主动光纤网络 (Active Optical Network, AON) ===> 本质为交换因特网

   - 被动光纤网络 (Passive Optical Network, PON)

     <img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2013.25.56.png" alt="截屏2022-10-08 13.25.56" style="zoom:50%;" />

2. 企业(和家庭接入)：以太网和WiFi

   <img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2013.30.09.png" alt="截屏2022-10-08 13.30.09" style="zoom:50%;" />

3. 广域无线接入：3G和LTE

#### 1.2.2 物理媒体

- 导引型媒体
- 非导引型媒体

### 1.3 网络核心

#### 1.3.1 分组交换

如果某源端系统或分组交换 机经过一条链路发送一个 L 比特的分组，链路的传输速率为 R 比特/秒，则传输该分组的 时间为 $\frac{L}{R}$秒 

1. 存储转发传输

   多数分组交换机在链路的输入端使用 存储转发传输 (store-and-forward transmission) 机制

   通过由N条速率均为R的链路组成的路径(在源和目的地之间有 N-1 台路由器)，从源到目的地发送一个分组。应用如上相同的逻辑，端到端时延是 :
   $$
   d_{端到端} = N\frac{L}{R}
   $$

2. 排队时延和分组丢失

   对于每条相连的链路，该分组交换机具有一个输出缓存 (output buffer, 也称为输出队列output queue) , 它用于存储路由器准备发往那条链路的分组。

   除了存储转发时延以外，分组还要承受输出缓存的排队时延 (queuing delay)，其取决于网络的拥塞程度；

   由于缓存空间的大小有限，可能出现缓存空间充满的情况，将出现丢包 (packet loss) , 到达的分组或已经排队的分组之一将被丢弃。

3. 转发表和路由选择协议

   每个端系统具有一个称为 IP 地址的地址，当源主机要想目的端系统发送一个分组时，源在该分组的首部包含了目的地的 IP 地址；每台路由器具有1个转发表(forwarding table) , 用于将目的地址 (或目的地址的一部分)映射成为输出链路

#### 1.3.2 电路交换

### 1.4 分组交换网中的时延、丢包和吞吐量

#### 1.4.1 分组交换网中的时延概述

节点总时延=处理时延($d_{proc}$)+排队时延($d_{queue}$)+传输时时延($d_{trans}$)+传播时延($d_{prop}$)

> 传输时延是路由器推出packet所需要的时间
>
> 传播时延是1bit从一台路由器到另一台路由器所需要的时间

#### 1.4.2 排队时延和丢包

**排队时延($d_{queue}$)**

排队时延很大程度取决于流量到达该队列的速率、链路的传输速率和到达流量的性质，即流量是周期性到达还是以突发形式到达：

令$a$(pkt/s)表示分组到达队列的平均速率，$\frac{La}{R}$称为**流量强度**，设计系统时流量强度不能大于1

**丢包**

到达的分组将发现一个满的队列，由于没有地方存储这个分组，路由器将丢弃 (drop) 该分组， 即该分组将会丢失 (lost)

#### 1.4.3 端到端时延

假设在源主机和目的主机之间有N-1台路由器 & 该网络是无拥塞的($d_{queue}$是微不足道的)
$$
d_{end-end} = N(d_{proc}+d_{trans}+d_{prop})
$$
式中$d_{trans}=\frac{L}{R}$，其中L是分组长度

#### 1.4.4 计算机网络中的吞吐量

文件由F比特组成， 主机B接收到所有F比特用去T秒， 则文件传送的**平均**吞吐量 (average throughput) 是$\frac{F}{T}$bps

**瞬时**吞吐量是某主机接收文件的速率

**瓶颈链路**：链路上的速率不同，传输速度是最小值

从服务器到客户的文件传输吞吐量是$min\{R_1, R_2,...,R_N\}$

#### <img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2019.55.02.png" alt="截屏2022-10-08 19.55.02" style="zoom:50%;" />

### 1.5 协议层次及其服务模型

#### 1.5.1 分层的体系结构

1. 协议分层

   - 应用层

     e.g. HTTP、SMTP和FTP 

     用层协议即域名系统 (DNS) 完成的

     应用层的信息分组称**报文(message)**

   - 运输层

     - TCP：将长报文划分为短报文，并提供拥塞控制机制
     - UDP：向应用程序提供无连接服务；这是一种不提供不必要服务的服务，没有可靠性，没有流量控制，也没有拥塞控制 

     运输层的分组称为**报文段 (segment)**

   - 网络层

     网络层负责将称为**数据报(datagram)**

     网际协议IP ===> 仅有一个

   - 链路层

     e.g. 包括以太网、WiFi 和电缆接入网的DOCSIS协议 

     链路层分组称为**帧 (frame) **

   - 物理层

     将该帧中的一个个比特从一个节点移动到下一个节点 

   <img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2019.59.19.png" alt="截屏2022-10-08 19.59.19" style="zoom:50%;" />

2. OSI模型

#### 1.5.2 封装

<img src="https://xmtxpic.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2022-10-08%2020.31.45.png" alt="截屏2022-10-08 20.31.45" style="zoom:50%;" />

### 1.6 面对攻击的网络

## 第2章 应用层

